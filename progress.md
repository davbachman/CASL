Original prompt: OK, let's add some I/O. When you open up the history pane, there should be a button to print history. There should be a save and import buttons somewhere to save custom defined tools, and import saved tools. There should also be Save and Import Construction buttons to save all work, and resume where you left off.

## Work log
- Added toolbar controls for saving/importing tools and full construction snapshots.
- Added hidden file inputs and import handlers.
- Added history pane `Print History` action with print-friendly popup rendering.
- Added tool JSON serialization/deserialization with ID remapping to avoid collisions.
- Added full construction serialization/deserialization (docs, views, custom tools, active geometry/tool, show steps), with undo stack reset on import.
- Added basic normalization for imported docs/views and active tool fallback behavior.
- Replaced the top control strip with a real menubar (`File`, `Model`, `Edit`, `Window`) and wired each item to existing app actions.
- Added menu UI state syncing for selected model and Show/Hide History enablement.
- Renamed `Window` to `View` and added `Show Steps` / `Hide Steps` commands wired to step-visibility toggle state.
- Updated save actions to use native save-file dialogs (`showSaveFilePicker`) for choosing filename/location when supported.
- Fixed menubar command routing to call app actions directly (instead of synthetic hidden-button clicks) so save dialogs retain trusted user activation.
- Exposed `createApp` command API and routed menubar actions through it to avoid user-activation loss for dialog APIs.
- Added legacy Chromium save-dialog support (`chooseFileSystemEntries`) and improved blocked-permission detection for native save dialogs.
- Added Safari-specific save helper window fallback with explicit "Download Linked File As..." instructions and copy-JSON option.
- Reworked `Geometry` menu into grouped hover submenus: Euclidean (Standard/Inversive), Spherical (Standard), Hyperbolic (Poincare Disk/Half Plane).
- Added backend model-switch conversion for equivalent geometry families:
  - Euclidean ↔ Inversive via unit-circle inversion centered at `∞`
  - Hyperbolic Poincare ↔ Half-plane via Cayley transform in real coordinates
- Added converted-doc sanitization (constraints/history cleanup) and auto-fit of 2D view after cross-model conversion.
- Added two hyperbolic model options in Geometry menu: `Klein` and `Hyperboloid` (and corresponding hidden select options).
- Added new hyperbolic conversion helpers (`src/engine/hyperbolicModels.js`) for:
  - Poincare ↔ Half-plane (Cayley)
  - Poincare ↔ Klein
  - Poincare ↔ Hyperboloid
- Reworked hyperbolic model-switch conversion so all hyperbolic models convert through an internal Poincare chart; constructions now persist across:
  - Poincare, Half-plane, Klein, Hyperboloid
- Added shared hyperbolic curve sampling helpers (`src/engine/hyperbolicCurves.js`) for robust rendering/hit-testing.
- Added hyperboloid projection/inverse helpers (`src/engine/hyperboloidView.js`) to support 3D hyperboloid display and interaction.
- Updated renderer:
  - Klein model now renders geodesics as straight chords in the disk.
  - Klein circles render as sampled non-round curves (from mapped Poincare circles).
  - Hyperboloid model renders as a rotatable 3D surface with projected points/curves.
- Updated input controller:
  - Klein clicks/drags convert display coordinates to internal Poincare coordinates.
  - Hyperboloid supports rotate/zoom and click/drag via inverse projection to internal Poincare coordinates.
  - Curve hit-testing/snapping for Klein and Hyperboloid now use sampled screen-space distances.
- Improved Geometry submenu usability by removing hover-gap dead zone between parent and child submenus and adding a hover bridge area in CSS.
- Added spherical submodel `Spherical (Stereographic)` to the Geometry menu and hidden model select.
- Added shared stereographic helpers (`src/engine/stereographic.js`) for sphere↔plane projection and spherical-plane sampling.
- Added stereographic renderer path:
  - white Euclidean-style plane
  - fixed designated marker `S` at the model origin
  - spherical lines/circles rendered via stereographic projection of spherical planes
  - spherical points projected to the plane with labels/highlights.
- Added stereographic input path:
  - 2D pan/zoom controls (non-orbital)
  - click/drag mapped through inverse stereographic projection to sphere points
  - curve snapping and intersections for spherical objects in stereographic view.
- Updated custom tool builder/execution to treat standard spherical and stereographic as the same spherical geometry class.
- Added cross-model persistence for spherical family (`Standard` ↔ `Stereographic`) so constructions carry between both views.
- Added Euclidean submodel `Perspective`:
  - Geometry menu option under Euclidean and hidden select option.
  - Horizon-line rendering with white construction region below and sky tint above.
  - Construction drawing clipped to the region below the horizon.
  - Point/domain constraints enforced to the below-horizon half-plane.
  - Euclidean-family model switching now includes `Perspective` (identity with standard Euclidean, plus inversive conversion paths preserved).

## Notes
- JavaScript runtime syntax check was not run because `node` is not available in the current environment.
- Browser-level interaction testing is still required for Klein/Hyperboloid custom-tool edge cases.

## Next TODOs
- Manually test import/export round-trip in browser with multiple geometries and custom tools.
- Manually verify popup print flow in browsers with strict popup blocking settings.
- Manually test menubar behavior (outside click close, Escape close, menu command routing).
- Manually verify all hyperbolic model switches preserve constructions in both directions:
  - Poincare ↔ Half-plane, Poincare ↔ Klein, Poincare ↔ Hyperboloid, and cross-pair routes.
- Manually test custom tool application while in Klein and Hyperboloid models, especially intersection-heavy tools.
- Manually verify stereographic behavior:
  - switching `Spherical Standard` ↔ `Spherical Stereographic` preserves all objects
  - stereographic click/drag/snap/intersect parity with standard spherical behavior
  - custom tools built in one spherical submodel run correctly in the other.
